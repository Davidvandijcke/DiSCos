<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DiSCo">
<title>Empirical Application in Gunsilius (2023) • DiSCo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Empirical Application in Gunsilius (2023)">
<meta property="og:description" content="DiSCo">
<meta property="og:image" content="http://www.davidvandijcke.com/DiSCo/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DiSCo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Dube2019.html">Empirical Application in Gunsilius (2023)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Empirical Application in Gunsilius (2023)</h1>
                        <h4 data-toc-skip class="author">David Van
Dijcke</h4>
            
            <h4 data-toc-skip class="date">2023-12-09</h4>
      
      <small class="dont-index">Source: <a href="NA/NA/NA/blob/HEAD/vignettes/Dube2019.Rmd"><code>vignettes/Dube2019.Rmd</code></a></small>
      <div class="d-none name"><code>Dube2019.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to use the DiSCo package by way of the
empirical application in <span class="citation">Gunsilius (2023)</span>,
which is based on <span class="citation">Dube (2019)</span>. We
illustrate the use of the two main functions: 1) <code>DiSCo</code>,
which estimates the raw distributional counterfactuals, computes
confidence intervals, and optionally performs a permutation test; and 2)
<code>DiSCoTEA</code>, the “Treatment Effect Aggregator”, which takes in
the distributional counterfactuals and computes aggregate treatment
effects using a user-specified aggregation statistic.</p>
</div>
<div class="section level2">
<h2 id="distributional-synthetic-controls">Distributional Synthetic Controls<a class="anchor" aria-label="anchor" href="#distributional-synthetic-controls"></a>
</h2>
<p>We briefly review the main idea behind Distributional Synthetic
Controls. Denote <span class="math inline">\(Y_{jt,N}\)</span> the
outcome of group <span class="math inline">\(j\)</span> in time period
<span class="math inline">\(t\)</span> in the absence of an
intervention. Also denote <span class="math inline">\(Y_{jt,I}\)</span>
the outcome in the presence of an intervention at time <span class="math inline">\(t &gt; T_0\)</span>. Denote the quantile function,
<span class="math display">\[
F^{-1}(q):=\inf _{y \in \mathbb{R}}\{F(y) \geq q\}, \quad q \in(0,1),
\]</span> where <span class="math inline">\(F(y)\)</span> is the
corresponding cumulative distribution function. One unit <span class="math inline">\(j=1\)</span> has received treatment, while the
other units <span class="math inline">\(j=2,\ldots,J\)</span> have not.
Then the goal is to estimate the counterfactual quantile function <span class="math inline">\(F_{Y_{1 t}, N}^{-1}\)</span> of the treated unit
had it not received treatment by an optimally weighted average of the
control units’ quantile functions, <span class="math display">\[
F_{Y_{1 t}, N}^{-1}(q)=\sum_{j=2}^{J+1} \lambda_j^* F_{Y_{j t}}^{-1}(q)
\quad \text { for all } q \in(0,1)
\]</span><br>
In practice, we do this by solving the following optimization problem:
<span class="math display">\[
\vec{\lambda}_t^*=\underset{\vec{\lambda} \in
\Delta^J}{\operatorname{argmin}} \int_0^1\left|\sum_{j=2}^{J+1}
\lambda_j F_{Y_{j t}}^{-1}(q)-F_{Y_{1 t}}^{-1}(q)\right|^2 d q
\]</span>which gives an optimal weight for each unit-period combination.
This problem can be solved by a simple weighted regression, which is
implemented in the <code>DiSCo_weights_reg</code> function. To obtain
the overall optimal weights <span class="math inline">\(\vec{\lambda}^*\)</span>, we take the average of
the optimal weights across all periods.</p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>To get coding, we load the data from <span class="citation">Dube
(2019)</span>, which is available in the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dube"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dube</span><span class="op">)</span></span>
<span><span class="co">#    time_col id_col     y_col</span></span>
<span><span class="co"># 1:     1998      1 2.7912171</span></span>
<span><span class="co"># 2:     1998      1 0.1659509</span></span>
<span><span class="co"># 3:     1998      1 1.6747302</span></span>
<span><span class="co"># 4:     1998      1 2.0880055</span></span>
<span><span class="co"># 5:     1998      1 3.6397150</span></span>
<span><span class="co"># 6:     1998      1 1.8608114</span></span></code></pre></div>
<p>To learn more about the data, just type <code><a href="../reference/dube.html">?dube</a></code> in the
console. We have already renamed the outcome, id, and time variables to
<code>y_col</code>, <code>id_col</code>, and <code>time_col</code>,
respectively, which is required before passing the dataframe to the
DiSCo command. We also need to set the two following parameters:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id_col.target</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">t0</span> <span class="op">&lt;-</span> <span class="fl">2003</span></span></code></pre></div>
<p>which indicate the id of the treated unit and the time period of the
intervention, respectively. We can now run the DiSCo command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">copy</span><span class="op">(</span><span class="va">dube</span><span class="op">)</span></span>
<span><span class="va">disco</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DiSCo.html">DiSCo</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">id_col.target</span>, <span class="va">t0</span>, G <span class="op">=</span> <span class="fl">1000</span>, num.cores <span class="op">=</span> <span class="fl">2</span>, permutation <span class="op">=</span> <span class="cn">TRUE</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boots <span class="op">=</span> <span class="fl">1000</span>, graph <span class="op">=</span> <span class="cn">TRUE</span>, simplex<span class="op">=</span><span class="cn">TRUE</span>, seed<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Computing confidence intervals for period: 1998</span></span>
<span><span class="co"># Computing confidence intervals for period: 1999</span></span>
<span><span class="co"># Computing confidence intervals for period: 2000</span></span>
<span><span class="co"># Computing confidence intervals for period: 2001</span></span>
<span><span class="co"># Computing confidence intervals for period: 2002</span></span>
<span><span class="co"># Computing confidence intervals for period: 2003</span></span>
<span><span class="co"># Computing confidence intervals for period: 2004</span></span>
<span><span class="co"># Starting permutation test...Permutation finished!</span></span></code></pre></div>
<p><img src="Dube2019_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<p>where we have chosen a grid (<code>G</code>) of 1000 quantile and
opted for parallel computation with 2 cores to speed up the permutation
test and confidence intervals (<code>CI</code> is set to
<code>TRUE</code>), which we calculate using 500 resamples
(<code>boots</code>). We also set the <code>seed</code> explicitly in
the function call, which ensures reproducibility across the parallel
cores.</p>
<p>The returned <code>disco</code> object contains a host of information
produced by the command. Typing <code><a href="../reference/DiSCoT.html">?DiSCoT</a></code> in the console
pulls up the help files which lay out the precise structure of the
returned object. For now, we will just have a look at the estimated
weights,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># retrieve the weights</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">disco</span><span class="op">$</span><span class="va">Weights_DiSCo_avg</span></span>
<span></span>
<span><span class="co"># retrieve the control unit IDs </span></span>
<span><span class="va">controls</span> <span class="op">&lt;-</span> <span class="va">disco</span><span class="op">$</span><span class="va">control_ids</span></span>
<span></span>
<span><span class="co"># store in a dataframe</span></span>
<span><span class="va">weights_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>weights <span class="op">=</span> <span class="va">weights</span>, fips <span class="op">=</span> <span class="va">controls</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># merge with state fips codes (built into the maps package)</span></span>
<span><span class="va">weights_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">weights_df</span>, <span class="fu">maps</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/maps/man/state.fips.html" class="external-link">state.fips</a></span>, by <span class="op">=</span> <span class="st">"fips"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">setorder</span><span class="op">(</span><span class="va">weights_df</span>, <span class="op">-</span><span class="va">weights</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">weights_df</span><span class="op">)</span></span>
<span><span class="co">#    fips       weights ssa region division abb              polyname</span></span>
<span><span class="co"># 12   24  1.186556e-01  21      3        5  MD              maryland</span></span>
<span><span class="co"># 34   51  1.008450e-01  49      3        5  VA   virginia:chesapeake</span></span>
<span><span class="co"># 35   51  1.008450e-01  49      3        5  VA         virginia:main</span></span>
<span><span class="co"># 36   51  1.008450e-01  49      3        5  VA virginia:chincoteague</span></span>
<span><span class="co"># 20   33  8.173559e-02  30      1        1  NH         new hampshire</span></span>
<span><span class="co"># 25   38  7.586657e-02  35      2        4  ND          north dakota</span></span>
<span><span class="co"># 18   31  7.351458e-02  28      2        4  NE              nebraska</span></span>
<span><span class="co"># 21   35  6.323485e-02  32      4        8  NM            new mexico</span></span>
<span><span class="co"># 4     8  5.865657e-02   6      4        8  CO              colorado</span></span>
<span><span class="co"># 29   45  5.372624e-02  42      3        5  SC        south carolina</span></span>
<span><span class="co"># 13   26  5.168543e-02  23      2        3  MI        michigan:south</span></span>
<span><span class="co"># 14   26  5.168543e-02  23      2        3  MI        michigan:north</span></span>
<span><span class="co"># 8    19  4.900108e-02  16      2        4  IA                  iowa</span></span>
<span><span class="co"># 11   22  4.718392e-02  19      3        7  LA             louisiana</span></span>
<span><span class="co"># 16   29  4.710395e-02  26      2        4  MO              missouri</span></span>
<span><span class="co"># 33   49  3.618461e-02  46      4        8  UT                  utah</span></span>
<span><span class="co"># 32   48  3.098754e-02  45      3        7  TX                 texas</span></span>
<span><span class="co"># 5    13  2.789892e-02  11      3        5  GA               georgia</span></span>
<span><span class="co"># 38   56  2.764866e-02  53      4        8  WY               wyoming</span></span>
<span><span class="co"># 19   32  2.412182e-02  29      4        8  NV                nevada</span></span>
<span><span class="co"># 22   37  1.574197e-02  34      3        5  NC north carolina:knotts</span></span>
<span><span class="co"># 23   37  1.574197e-02  34      3        5  NC   north carolina:spit</span></span>
<span><span class="co"># 24   37  1.574197e-02  34      3        5  NC   north carolina:main</span></span>
<span><span class="co"># 7    18  1.230765e-02  15      2        3  IN               indiana</span></span>
<span><span class="co"># 30   46  3.899512e-03  43      2        4  SD          south dakota</span></span>
<span><span class="co"># 1     1  1.486812e-16   1      3        6  AL               alabama</span></span>
<span><span class="co"># 37   54  1.210699e-16  51      3        5  WV         west virginia</span></span>
<span><span class="co"># 17   30  8.053257e-17  27      4        8  MT               montana</span></span>
<span><span class="co"># 2     4  2.680380e-17   3      4        8  AZ               arizona</span></span>
<span><span class="co"># 31   47  2.591531e-17  44      3        6  TN             tennessee</span></span>
<span><span class="co"># 27   40  1.615722e-17  37      3        7  OK              oklahoma</span></span>
<span><span class="co"># 28   42 -4.227009e-18  39      1        2  PA          pennsylvania</span></span>
<span><span class="co"># 26   39 -1.708190e-17  36      2        3  OH                  ohio</span></span>
<span><span class="co"># 9    20 -3.531062e-17  17      2        4  KS                kansas</span></span>
<span><span class="co"># 15   28 -3.747543e-17  25      3        6  MS           mississippi</span></span>
<span><span class="co"># 3     5 -2.273750e-16   4      3        7  AR              arkansas</span></span>
<span><span class="co"># 10   21 -2.314121e-16  18      3        6  KY              kentucky</span></span>
<span><span class="co"># 6    16 -2.319602e-16  13      4        8  ID                 idaho</span></span></code></pre></div>
<p>When we ran the <code>DiSCo</code> command, we set
<code>permutation</code> to <code>TRUE</code>, which runs the
permutation test described in the paper (see <code><a href="../reference/DiSCo_per.html">?DiSCo_per</a></code> for
more details). This will allow us to inspect the permutation inference
results below. Already, by setting <code>graph</code> to
<code>TRUE</code>, the function displayed a plot of the full
distribution of permutation tests. The black solid line shows the fit of
the “true” synthetic control. The fact that it does not diverge stronger
than the other lines in gray after treatment suggests that the treatment
had no effect.</p>
<p>For context, the y-axis is the squared Wasserstein distance between
the counterfactual and observed quantile functions, <span class="math display">\[
d_{t t}^2:=\int_0^1\left|F_{Y_{u t, N}}^{-1}(q)-F_{Y_{u
t}}^{-1}(q)\right|^2 d q
\]</span>and, as in <span class="citation">Abadie, Diamond, and
Hainmueller (2010)</span> we take the ratio of post- to pre-intervention
Wasserstein distance to account for variation in the pre-treatment fit
across placebo tests, <span class="math display">\[
r_j=\frac{R_j\left(T_0+1, T\right)}{R_j\left(1, T_0\right)}
\]</span> and calculate the p-value for the permutation test as, <span class="math display">\[
p=\frac{1}{J+1} \sum_{j=1}^{J+1} H\left(r_j-r_1\right),
\]</span>where <span class="math inline">\(H(x)\)</span> is the
Heaviside function which is 1 if <span class="math inline">\(x\geq
0\)</span> and 0 otherwise. This p-value gives the probability of
observing a placebo test with a larger ratio than the true treatment
effect. It can be retrieved by calling</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">disco</span><span class="op">$</span><span class="va">perm</span><span class="op">)</span></span>
<span><span class="co"># Permutation test for quantile range: [0, 1] </span></span>
<span><span class="co"># P-value:  0.176 </span></span>
<span><span class="co"># Number of control units:  33</span></span></code></pre></div>
<p>The p-value is larger than 0.05, which confirms the visual result
from the plot above, while accounting for potential differences in
pre-treatment fit across placebo units.</p>
<p>Finally, we can use the DiSCo Treatment Effect Aggregator
(<code>DiSCoTEA</code>) function to aggregate the resulting
counterfactual quantile functions into various treatment effect
measures. For example, we can calculate the difference between the
counterfactual and observed quantile functions as follows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">discot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DiSCoTEA.html">DiSCoTEA</a></span><span class="op">(</span><span class="va">disco</span>,  agg<span class="op">=</span><span class="st">"quantileDiff"</span>, graph<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Dube2019_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">discot</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Call:</span></span>
<span><span class="co"># DiSCoTEA(disco = disco, agg = "quantileDiff", graph = TRUE)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Reference: Gunsilius, Florian F. "Distributional synthetic controls." Econometrica 91, no. 3 (2023): 1105-1117. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Aggregated Distribution Differences, Quantile Δ </span></span>
<span><span class="co">#  Time X_from X_to Quantile Δ Std. Error   [95%  Conf. Band]  </span></span>
<span><span class="co">#  2003   0.00 0.25    -0.0436     0.0090 -0.0598     -0.0246 *</span></span>
<span><span class="co">#  2003   0.25 0.50     0.0355     0.0126  0.0121      0.0609 *</span></span>
<span><span class="co">#  2003   0.50 0.75     0.1702     0.0160  0.1403      0.2004 *</span></span>
<span><span class="co">#  2003   0.75 1.00     0.7026     0.0526  0.5957      0.8016 *</span></span>
<span><span class="co">#  2004   0.00 0.25     0.0952     0.0086  0.0797      0.1127 *</span></span>
<span><span class="co">#  2004   0.25 0.50     0.1259     0.0115  0.1038      0.1477 *</span></span>
<span><span class="co">#  2004   0.50 0.75     0.2233     0.0152  0.1934      0.2527 *</span></span>
<span><span class="co">#  2004   0.75 1.00     1.1784     0.0503  1.0763      1.2679 *</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes: `*' Confidence band for distribution differences does not cover 0</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Permutation test for quantile range: [0, 1] </span></span>
<span><span class="co"># P-value:  0.176 </span></span>
<span><span class="co"># Number of control units:  33 </span></span>
<span><span class="co"># Number of pre-treatment periods: 5</span></span>
<span><span class="co"># Number of post-treatment periods: 2</span></span>
<span><span class="co"># N=652,870</span></span></code></pre></div>
<p>Calling <code>summary</code> on the returned object prints a table
summarizing the effects across the distribution. You can choose the
intervals of quantiles over which it aggregates using the
<code>samples</code> parameter. If you calculated the permutation test
and confidence intervals in the <code>DiSCo</code> function, these are
reported as well.</p>
<p>Setting <code>graph</code> to <code>TRUE</code> also prints a plot of
the distribution differences over time You can focus on specific years
using the <code>t_plot</code> parameter. You can use the other
parameters of the <code>DiSCOTEA</code> function to adjust the basic
appearance of the plots, or directly alter the returned ggplot object
that is stored in the returned <code>DiSCoT</code> object.</p>
<p>Looking at the plot of the quantile differences, there appear to be
positive effects of the minimum wage increase on household income for
the upper quantile. That seems a little strange. The first indication
that this is probably a spurious result comes from the permutation test,
which could not reject the hypothesis test of there being no effect.</p>
</div>
<div class="section level2">
<h2 id="robustness-tests">Robustness tests<a class="anchor" aria-label="anchor" href="#robustness-tests"></a>
</h2>
<p>The package offers various ways to further test suspected effects.
For example, we can focus on a specific part of the distribution, and
construct a separate synthetic control for it. Mathematically, this
comes down to,</p>
<p><span class="math display">\[
\vec{\lambda}_t^*=\underset{\vec{\lambda} \in
\Delta^J}{\operatorname{argmin}}
\int_{\text{q_min}}^{\text{q_max}}\left|\sum_{j=2}^{J+1} \lambda_j
F_{Y_{j t}}^{-1}(q)-F_{Y_{1 t}}^{-1}(q)\right|^2 d q,
\]</span></p>
<p>where <span class="math inline">\(\text{q_min} &lt;
\text{q_max}\)</span> are the bounds of the quantile range we’re
interested in. Doing this in R is as simple as,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">disco</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DiSCo.html">DiSCo</a></span><span class="op">(</span><span class="va">dube</span>, id_col.target<span class="op">=</span><span class="va">id_col.target</span>, t0<span class="op">=</span><span class="va">t0</span>, G <span class="op">=</span> <span class="fl">250</span>, num.cores <span class="op">=</span> <span class="fl">2</span>, permutation <span class="op">=</span> <span class="cn">TRUE</span>, CI <span class="op">=</span> <span class="cn">TRUE</span>, boots <span class="op">=</span> <span class="fl">1000</span>, graph <span class="op">=</span> <span class="cn">FALSE</span>, q_min <span class="op">=</span> <span class="fl">0.7</span>, q_max<span class="op">=</span><span class="fl">0.95</span>, seed<span class="op">=</span><span class="fl">1</span>, simplex<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Computing confidence intervals for period: 1998</span></span>
<span><span class="co"># Computing confidence intervals for period: 1999</span></span>
<span><span class="co"># Computing confidence intervals for period: 2000</span></span>
<span><span class="co"># Computing confidence intervals for period: 2001</span></span>
<span><span class="co"># Computing confidence intervals for period: 2002</span></span>
<span><span class="co"># Computing confidence intervals for period: 2003</span></span>
<span><span class="co"># Computing confidence intervals for period: 2004</span></span>
<span><span class="co"># Starting permutation test...Permutation finished!</span></span></code></pre></div>
<p>where we set the lower bound to 0.75 since that where the effects
start appearing clearly, and the upper bound to 0.95 to account for the
fact that the CPS data used in <span class="citation">Dube (2019)</span>
is imputed for the top income quantiles, which may explain the erratic
behavior of the estimator at those quantiles. Another way one could try
to deal with irregularity in the estimated quantile functions is by
using the <code>qmethod</code> option in the <code>DiSCo</code> command,
which allows for the use of alternative quantile estimation methods that
can account for non-smoothness and extreme values. As above, we plot the
results using the <code>DiScoTEA</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">discot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DiSCoTEA.html">DiSCoTEA</a></span><span class="op">(</span><span class="va">disco</span>, agg<span class="op">=</span><span class="st">"quantileDiff"</span>, graph<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Dube2019_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">discot</span><span class="op">)</span> </span>
<span><span class="co"># </span></span>
<span><span class="co"># Call:</span></span>
<span><span class="co"># DiSCoTEA(disco = disco, agg = "quantileDiff", graph = TRUE)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Reference: Gunsilius, Florian F. "Distributional synthetic controls." Econometrica 91, no. 3 (2023): 1105-1117. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Aggregated Distribution Differences, Quantile Δ </span></span>
<span><span class="co">#  Time X_from X_to Quantile Δ Std. Error  [95%  Conf. Band]  </span></span>
<span><span class="co">#  2003    0.7 0.95     0.1313     0.0114 0.1092      0.1536 *</span></span>
<span><span class="co">#  2004    0.7 0.95     0.1430     0.0112 0.1220      0.1663 *</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes: `*' Confidence band for distribution differences does not cover 0</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Permutation test for quantile range: [0.7, 0.95] </span></span>
<span><span class="co"># P-value:  0.0588 </span></span>
<span><span class="co"># Number of control units:  33 </span></span>
<span><span class="co"># Number of pre-treatment periods: 5</span></span>
<span><span class="co"># Number of post-treatment periods: 2</span></span>
<span><span class="co"># N=652,870</span></span></code></pre></div>
<p>For this restricted range of quantiles, the estimator appears to
produce a slightly better — though not perfect – pre-treatment fit. We
still observe the positive effects in the post-treatment periods, but
the restricted permutation test is still not significant. Overall, we
cannot reject the null hypothesis of there being no effect of the
treatment.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this vignette, we have demonstrated the DiSCo package using the
data from the empirical application in <span class="citation">Gunsilius
(2023)</span>. We estimated the difference in between the quantile
functions of the distributional synthetic control constructed with the
<code>DiSco</code> command and the observed quantile function. To test
for the presence of treatment effects, we inspected the pre-treatment
distributional fit, carried out a permutation test, and re-estimated the
synthetic control for a restricted quantile range; all these robustness
tests are available in the DiSCo package, together with handy graphing
and aggregation tools.</p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-abadie2010synthetic" class="csl-entry">
Abadie, Alberto, Alexis Diamond, and Jens Hainmueller. 2010.
<span>“Synthetic Control Methods for Comparative Case Studies:
Estimating the Effect of California’s Tobacco Control Program.”</span>
<em>Journal of the American Statistical Association</em> 105 (490):
493–505.
</div>
<div id="ref-dube2019minimum" class="csl-entry">
Dube, Arindrajit. 2019. <span>“Minimum Wages and the Distribution of
Family Incomes.”</span> <em>American Economic Journal: Applied
Economics</em> 11 (4): 268–304.
</div>
<div id="ref-gunsilius2023distributional" class="csl-entry">
Gunsilius, Florian F. 2023. <span>“Distributional Synthetic
Controls.”</span> <em>Econometrica</em> 91 (3): 1105–17.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Van Dijcke, Florian Gunsilius, Siyun He.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
